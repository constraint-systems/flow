(this.webpackJsonpflow=this.webpackJsonpflow||[]).push([[0],{21:function(e,t,n){},22:function(e,t,n){},25:function(e,t,n){"use strict";n.r(t);var r=n(3),i=n.n(r),c=n(10),o=n.n(c),a=(n(21),n(22),n(6)),s=n.n(a),l=n(7),d=n(2),u=n(0),h=n(9),b={},j=Object(u.b)({key:"windowSize",default:[null,null]}),f=Object(u.c)({key:"setWindowSize",set:function(e){var t=e.set;console.log("set window size"),t(j,[window.innerWidth,window.innerHeight])}}),p=Object(u.b)({key:"canvas",default:null}),O=Object(u.b)({key:"padding",default:8}),g=Object(u.b)({key:"image",default:new Image(10,10)}),v=Object(u.b)({key:"zoom",default:1}),x=Object(u.c)({key:"adjustZoom",set:function(e,t){var n=e.get,r=e.set,i=t.diff,c=n(v);r(v,c+i)}}),w=Object(u.b)({key:"cell",default:[0,0,32,32]}),y=Object(u.b)({key:"cursor",default:[2,8,14,12]}),m=Object(u.c)({key:"cursorLimited",set:function(e,t){var n=e.get,r=e.set,i=function(e,t){e[2]=Math.min(t.cols,e[2]),e[3]=Math.min(t.rows,e[3]),e[0]=Math.min(e[0],t.cols-1),e[0]+e[2]<1&&(e[0]=1-e[2]);e[1]=Math.min(e[1],t.rows-1),e[1]+e[3]<1&&(e[1]=1-e[3]);return e}(t,n(H));r(y,i)}}),k=Object(u.c)({key:"imageCursor",get:function(e){var t=e.get,n=t(y),r=t(H),i=t(g),c=t(w),o=Math.max(0,n[0]),a=Math.max(0,n[1]),s=Math.min(r.cols,n[0]+n[2])-o,l=Math.min(r.rows,n[1]+n[3])-a;o=o*c[2]+r.xoff,a=a*c[3]+r.yoff,s*=c[2],l*=c[3];var d=Math.min(o+s,i.width),u=Math.min(a+l,i.height);return[o=Math.max(o,0),a=Math.max(a,0),d-o,u-a]}}),C=Object(u.c)({key:"visibleCursor",get:function(e){var t=e.get,n=t(v),r=t(O),i=t(k).map((function(e){return e*n}));return i[0]+=r,i[1]+=r,i}}),L=Object(u.c)({key:"cursorOverlap",get:function(e){var t=e.get,n=t(y),r=t(H);return[n[0]<0,n[1]<0,r.cols<n[0]+n[2],r.rows<n[1]+n[3]]}});var M=Object(u.c)({key:"moveCursorBy",set:function(e,t){var n=e.get,r=e.set,i=t.moveBy,c=t.shift,o=n(y).slice();n(H);c?(o[0]+=i[0]*o[2],o[1]+=i[1]*o[3]):(o[0]+=i[0],o[1]+=i[1]),r(m,o)}});function E(e){var t=e.pixel,n=e.cell,r=e.padding,i=e.grid,c=e.zoom,o=t[0]/c,a=t[1]/c,s=Object(d.a)(n,4),l=(s[0],s[1],s[2]),u=s[3],h=i.xoff,b=i.yoff;i.cols,i.rows;return[Math.round((o-h-r)/l),Math.round((a-b-r)/u)]}var P=Object(u.c)({key:"placeCursor",set:function(e,t){var n=e.get,r=e.set,i=t.pixel,c=n(y).slice(),o=n(O),a=E({pixel:i,cell:n(w),padding:o,grid:n(H),zoom:n(v)}),s=Object(d.a)(a,2),l=s[0],u=s[1];c[0]=l,c[1]=u,c[2]=1,c[3]=1,r(m,c)}}),R=Object(u.b)({key:"dragResizeStart",default:[0,0]}),S=Object(u.c)({key:"setDragResizeStart",set:function(e,t){var n=e.get,r=e.set,i=t.pixel,c=n(O),o=n(w),a=n(H),s=E({pixel:i,cell:o,padding:c,grid:a,zoom:n(v)});s=[Math.min(Math.max(0,s[0]),a.cols),Math.min(Math.max(0,s[1]),a.rows)],r(R,s)}}),I=Object(u.c)({key:"setCornerResizeStart",set:function(e,t){var n,r=e.get,i=e.set,c=t.pinCorner,o=r(y).slice();r(H);"topLeft"===c?n=[o[0],o[1]]:"topRight"===c?n=[o[0]+o[2],o[1]]:"bottomLeft"===c?n=[o[0],o[1]+o[3]]:"bottomRight"===c&&(n=[o[0]+o[2],o[1]+o[3]]),i(R,n)}}),z=Object(u.c)({key:"resizeBy",set:function(e,t){var n=e.get,r=e.set,i=t.diff,c=n(y).slice(),o=n(H);c[2]+=i[0],c[3]+=i[1],c[2]=Math.max(1,c[2]),c[3]=Math.max(1,c[3]),c[2]=Math.min(c[2],o.cols-c[0]),c[3]=Math.min(c[3],o.rows-c[1]),r(y,c)}}),D=Object(u.b)({key:"cursorMoveStart",default:[0,0]}),A=Object(u.c)({key:"setCursorMoveStart",set:function(e,t){var n=e.get,r=e.set,i=t.pixel,c=n(O),o=n(w),a=n(H),s=n(y),l=E({pixel:i,cell:o,padding:c,grid:a,zoom:n(v)}),d=l[0]-s[0],u=l[1]-s[1];r(D,[].concat(Object(h.a)(l),[d,u]))}}),B=Object(u.c)({key:"setCursorMoveDrag",set:function(e,t){var n=e.get,r=e.set,i=t.pixel,c=n(O),o=n(w),a=n(H),s=E({pixel:i,cell:o,padding:c,grid:a,zoom:n(v)}),l=n(D),d=n(y).slice(),u=s[0]-l[0],h=s[1]-l[1];d[0]=Math.max(0,Math.min(a.cols-d[2],u+l[0]-l[2])),d[1]=Math.max(0,Math.min(a.rows-d[3],h+l[1]-l[3])),r(m,d)}}),T=Object(u.c)({key:"dragResize",set:function(e,t){var n=e.get,r=e.set,i=t.pixel,c=n(O),o=n(w),a=n(H),s=n(R),l=E({pixel:i,cell:o,padding:c,grid:a,zoom:n(v)}),d=Math.min(s[0],l[0]),u=Math.min(s[1],l[1]),h=Math.max(s[0],l[0]),b=Math.max(s[1],l[1]);d=Math.max(0,d),u=Math.max(0,u);var j=Math.min(a.cols-d,Math.abs(h-d)),f=Math.min(a.rows-u,Math.abs(b-u));0===j&&(j=1),0===f&&(f=1),r(m,[d,u,j,f])}}),N=Object(u.c)({key:"imageBounds",get:function(e){var t=e.get,n=(e.set,t(g));return{x1:0,y1:0,x2:n.width,y2:n.height}}}),H=Object(u.c)({key:"grid",get:function(e){var t=e.get,n=(e.set,t(w)),r=t(g),i=n[0]%n[2];i>0&&(i-=n[2]);var c=Math.ceil((r.width-i)/n[2]),o=n[1]%n[3];return o>0&&(o-=n[3]),{xoff:i,yoff:o,cols:c,rows:Math.ceil((r.height-o)/n[3])}}}),F=Object(u.c)({key:"renderSize",get:function(e){var t=e.get,n=t(g);if(null===n)return[20,20];var r=t(O),i=t(v);return[n.width*i+2*r,n.height*i+2*r]}}),U=Object(u.b)({key:"mode",default:"flow"}),V=(Object(u.b)({key:"flowChoicePoint",default:[0,0]}),Object(u.b)({key:"flows",default:[]})),W=Object(u.c)({key:"addFlow",set:function(e,t){var n=e.get,r=e.set,i=n(V).slice(),c=n(k);i.push({cursor:c,dir:t}),r(V,i)}}),G=Object(u.b)({key:"flow",default:!0}),X=Object(u.c)({key:"toggleFlow",set:function(e){var t=e.get,n=e.set,r=t(G);n(G,!r)}}),Y=Object(u.b)({key:"showGrid",default:!1}),J=Object(u.c)({key:"toggleGrid",set:function(e){var t=e.get,n=e.set,r=t(Y);n(Y,!r)}}),K=Object(u.b)({key:"showFlow",default:!1}),Z=Object(u.c)({key:"toggleShowFlow",set:function(e){var t=e.get,n=e.set,r=t(K);n(K,!r)}}),q=Object(u.b)({key:"buttonSize",default:matchMedia("(pointer:coarse)").matches?48:32}),_=(Object(u.b)({key:"pointer",default:matchMedia("(pointer:coarse)").matches?"coarse":"fine"}),Object(u.b)({key:"drawer",default:{w:320,h:220,o:"side"}}),Object(u.b)({key:"showImageMenu",default:!1})),Q=Object(u.b)({key:"showViewMenu",default:!1}),$=Object(u.b)({key:"showGridMenu",default:!1}),ee=Object(u.b)({key:"cursorColor",default:"#00ffff"}),te=Object(u.c)({key:"zoomLevels",get:function(e){var t=e.get,n=t(j),r=Object(d.a)(n,2),i=r[0],c=r[1],o=t(q),a=t(ce),s=t(g);c-=2*o+2+6,a&&(i-=320);var l=null,u=[.25,.5,1,1.5,2,4];return null!==(l=(s.width+2*b.padding)/(s.height+2*b.padding)>i/c?(i-2*b.padding)/s.width:(c-2*b.padding)/s.height)&&u.push(l),u.sort(),u}}),ne=Object(u.c)({key:"zoomIn",set:function(e){var t=e.get,n=e.set,r=t(te),i=t(v),c=r.reduce((function(e,t){return Math.abs(t-i)<Math.abs(e-i)?t:e})),o=r.indexOf(c)+1;o<r.length&&n(v,r[o])}}),re=Object(u.c)({key:"zoomOut",set:function(e){var t=e.get,n=e.set,r=t(te),i=t(v),c=r.reduce((function(e,t){return Math.abs(t-i)<Math.abs(e-i)?t:e})),o=r.indexOf(c)-1;o>-1&&n(v,r[o])}}),ie=Object(u.c)({key:"modifyCell",set:function(e,t){for(var n=e.get,r=e.set,i=n(w).slice(),c=0;c<i.length;c++)i[c]=parseInt(i[c])+parseInt(t[c]);r(w,i)}}),ce=Object(u.b)({key:"showShortuts",default:!1}),oe=Object(u.c)({key:"shortcutPadding",get:function(e){var t=e.get,n=t(ce),r=t(j)[0],i=t(F)[0],c=0;return n&&(r-i)/2<320&&(c=320),c}}),ae=Object(u.c)({key:"toggleShortcuts",set:function(e){var t=e.get,n=e.set,r=t(ce);n(ce,!r)}}),se=Object(u.b)({key:"showAbout",default:!1});Object(u.c)({key:"toggleShowAbout",set:function(e){var t=e.get,n=e.set,r=t(se);n(se,!r)}});function le(e,t){return e===t}var de=function(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){t(r)},r.src=e}))},ue=n(4);function he(e){var t=document.querySelector("#fileInput");function n(e){return r.apply(this,arguments)}function r(){return(r=Object(l.a)(s.a.mark((function t(r){var i,c,o,a,l;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=Object(ue.a)(this.files),t.prev=1,i.s();case 3:if((c=i.n()).done){t.next=15;break}if(!((o=c.value).type.indexOf("image")<0)){t.next=7;break}return t.abrupt("continue",13);case 7:return a=URL.createObjectURL(o),t.next=10,de(a);case 10:l=t.sent,e(l),this.removeEventListener("change",n);case 13:t.next=3;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(1),i.e(t.t0);case 20:return t.prev=20,i.f(),t.finish(20);case 23:case"end":return t.stop()}}),t,this,[[1,17,20,23]])})))).apply(this,arguments)}return t.addEventListener("change",n),t.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),t}function be(){var e=document.createElement("canvas"),t=document.createElement("a"),n=b.layersRef.current.imageLayer;e.width=n.width,e.height=n.height,e.getContext("2d").drawImage(n,0,0),e.toBlob((function(e){t.setAttribute("download","flow-"+Math.round((new Date).getTime()/1e3)+".png"),t.setAttribute("href",URL.createObjectURL(e)),t.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}))}))}function je(){return(je=Object(l.a)(s.a.mark((function e(t,n){var r,i,c,o,a,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),t.stopPropagation(),r=Object(ue.a)(t.clipboardData.items),e.prev=3,r.s();case 5:if((i=r.n()).done){e.next=17;break}if(!((c=i.value).type.indexOf("image")<0)){e.next=9;break}return e.abrupt("continue",15);case 9:return o=c.getAsFile(),a=URL.createObjectURL(o),e.next=13,de(a);case 13:l=e.sent,n(l);case 15:e.next=5;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(3),r.e(e.t0);case 22:return e.prev=22,r.f(),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[3,19,22,25]])})))).apply(this,arguments)}function fe(){return(fe=Object(l.a)(s.a.mark((function e(t,n){var r,i,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),t.stopPropagation(),r=t.dataTransfer.files[0],i=URL.createObjectURL(r),e.next=6,de(i);case 6:c=e.sent,n(c);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pe(e){return Oe.apply(this,arguments)}function Oe(){return(Oe=Object(l.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy";case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ge=function(){var e=Object(r.useRef)({}),t=Object(u.f)(M),n=Object(u.d)(U),i=Object(d.a)(n,2),c=i[0],o=i[1],a=Object(u.f)(se),h=Object(u.f)(W),j=Object(u.f)(X),f=Object(u.f)(Z),p=Object(u.f)(J),O=Object(u.f)(z),v=Object(u.d)(g),x=Object(d.a)(v,2),w=x[0],y=x[1],m=Object(u.f)(V),k=Object(u.f)(ne),C=Object(u.f)(re),L=Object(u.f)($),E=Object(u.f)(ae);return Object(r.useEffect)((function(){var n=e.current;function r(){return(r=Object(l.a)(s.a.mark((function e(r,i){var l,d,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("o"!==r){e.next=5;break}he((function(e){y(e),b.image=e,m([])})),e.next=14;break;case 5:if("i"!==r){e.next=13;break}return e.next=8,de(w.src);case 8:l=e.sent,y(l),b.image=l,e.next=14;break;case 13:"c"===r?m([]):"p"===r?be():"g"===r?L(!0):" "===r?j():"+"===r?k():"-"===r?C():";"===r?p():"/"===r?f():"?"===r?E():"a"===r&&a(!0);case 14:e.t0=c,e.next="move"===e.t0?17:"flow"===e.t0?31:"resize"===e.t0?33:42;break;case 17:e.t1=r,e.next="enter"===e.t1?20:"r"===e.t1?22:24;break;case 20:return o("flow"),e.abrupt("break",24);case 22:return o("resize"),e.abrupt("break",24);case 24:return d=[0,0],(n.arrowleft||n.h)&&(d[0]-=1),(n.arrowright||n.l)&&(d[0]+=1),(n.arrowup||n.k)&&(d[1]-=1),(n.arrowdown||n.j)&&(d[1]+=1),0===d[0]&&0===d[1]||(i.preventDefault(),t({moveBy:d,shift:i.shiftKey})),e.abrupt("break",42);case 31:return le(r,"escape")||le(r,"x")?o("move"):le(r,"arrowleft")||le(r,"h")?(h("w"),o("move")):le(r,"arrowright")||le(r,"l")?(h("e"),o("move")):le(r,"arrowup")||le(r,"k")?(h("n"),o("move")):(le(r,"arrowdown")||le(r,"j"))&&(h("s"),o("move")),e.abrupt("break",42);case 33:return le(r,"escape")&&o("move"),le(r,"enter")&&o("move"),u=[0,0],(n.arrowleft||n.h)&&(u[0]-=1),(n.arrowright||n.l)&&(u[0]+=1),(n.arrowup||n.k)&&(u[1]-=1),(n.arrowdown||n.j)&&(u[1]+=1),0===u[0]&&0===u[1]||(i.preventDefault(),O({diff:u})),e.abrupt("break",42);case 42:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function i(e){var t=e.key.toLowerCase();n[t]=!0,function(e,t){r.apply(this,arguments)}(t,e)}function d(e){var t=e.key.toLowerCase();n[t]=!1}return window.addEventListener("keydown",i),window.addEventListener("keyup",d),function(){window.removeEventListener("keydown",i),window.removeEventListener("keyup",d)}})),null};var ve=function(){var e=Object(u.e)(p),t=e.parentElement.parentElement,n=Object(u.e)(O),i=Object(u.f)(P),c=Object(u.d)(U),o=Object(d.a)(c,2),a=o[0],s=o[1],l=Object(u.f)(S),h=Object(u.f)(A),j=(Object(u.f)(x),Object(u.f)(g)),f=Object(u.f)(V),v=Object(u.f)(B),w=Object(u.f)(T),y=Object(r.useRef)({primary:{down:!1},secondary:{down:!1},clickWindow:!1,oneDrag:!1,twoDrag:!1,cursorDrag:!1,ignore:!1});function m(e){!function(e,t){fe.apply(this,arguments)}(e,(function(e){j(e),b.image=e,f([])}))}function k(e){!function(e,t){je.apply(this,arguments)}(e,(function(e){j(e),b.image=e,f([])}))}return Object(r.useEffect)((function(){var r=y.current,c=e.parentElement.parentElement,o=function(t){var n=e.getBoundingClientRect();return[t.clientX-n.left,t.clientY-n.top]};function a(t){return[Math.min(e.width-2*n,Math.max(n,t[0])),Math.min(e.height-2*n,Math.max(n,t[1]))]}function u(e){if(e.target.classList.contains("stopClick"))r.ignore=!0;else{var n=o(e);e.isPrimary?(r.primary.down=!0,r.primary.position=n):(r.secondary.down=!0,r.secondary.position=n),function(e){var t=e.Scene,n=e.pixel,r=t.visibleCursor,i=Object(d.a)(n,2),c=i[0],o=i[1];return c>r[0]&&c<r[0]+r[2]&&o>r[1]&&o<r[1]+r[3]}({Scene:b,pixel:n})?(r.cursorDrag=!0,s("move"),h({pixel:n})):i({pixel:r.primary.position}),t.setPointerCapture(e.pointerId)}}function j(e){var t=o(e);if(r.primary.down&&r.secondary.down||r.primary.down&&(r.twoDrag||r.oneDrag||(r.cursorDrag?v({pixel:t}):(l({pixel:a(t)}),s("resize"),r.oneDrag=!0))),e.isPrimary?r.primary.down&&(r.primary.position=t):r.secondary.down&&(r.secondary.position=t),r.oneDrag)r.cursorDrag||(s("resize"),w({pixel:t}));else if(r.twoDrag&&e.isPrimary){var n=t[0]-r.primary.position[0],i=t[1]-r.primary.position[1];c.scrollBy(-n,-i)}}function f(e){if(r.ignore)r.ignore=!1;else{var n=o(e);e.isPrimary?(r.primary.down=!1,r.primary.position=n):(r.secondary.down=!1,r.secondary.position=n),e.isPrimary&&(r.oneDrag||r.twoDrag||r.primary.down||r.clickWindow&&(r.clickWindow=!1,i({pixel:r.primary.position}))),r.primary.down||(r.twoDrag||s("flow"),r.oneDrag=!1,r.twoDrag=!1,r.cursorDrag=!1),t.releasePointerCapture(e.pointerId)}}return t.addEventListener("pointerdown",u),t.addEventListener("pointermove",j),t.addEventListener("pointerup",f),window.addEventListener("paste",k),window.addEventListener("dragover",pe),window.addEventListener("drop",m),function(){t.removeEventListener("pointerdown",u),t.removeEventListener("pointermove",j),t.removeEventListener("pointerup",f),window.removeEventListener("paste",k),window.removeEventListener("dragover",pe),window.removeEventListener("drop",m)}}),[a]),null},xe=n(5),we=n(1);function ye(e){var t=e.children,n=e.click,i=e.style,c=Object(r.useRef)(null),o=Object(r.useRef)(!1);return Object(we.jsx)("div",{role:"button",className:"hover",onPointerDown:function(e){n(),o.current=!0,clearInterval(c.current),setTimeout((function(){o.current&&(clearInterval(c.current),c.current=setInterval(n,40))}),300),e.target.setPointerCapture(e.pointerId)},onPointerUp:function(e){o.current=!1,clearInterval(c.current),e.target.releasePointerCapture(e.pointerId)},style:Object(xe.a)({textAlign:"center",minWidth:44},i),children:t})}function me(e){var t=e.children,n=e.click;e.k,e.c;return Object(we.jsxs)("div",{className:"clickButton",onClick:function(e){n(e)},style:{display:"flex",justifyContent:"space-between",padding:"0 8px",cursor:"pointer",height:44,borderBottom:"solid 1px #000",alignItems:"center"},children:[Object(we.jsx)("div",{children:t})," "]})}function ke(e){var t=e.children,n=e.style;return Object(we.jsx)("div",{onClick:function(e){e.stopPropagation()},style:Object(xe.a)({display:"flex",justifyContent:"space-between",padding:"0 8px",cursor:"pointer",height:44,lineHeight:"44px",alignItems:"center"},n),children:t})}function Ce(e){var t=e.val,n=e.setVal,r=e.modifyVal;Object(u.e)(q);return Object(we.jsxs)(i.a.Fragment,{children:[Object(we.jsx)("input",{style:{padding:0,textAlign:"right",flexGrow:1,height:26},value:t,onChange:function(e){n(e.target.value)},type:"number"}),Object(we.jsx)(ye,{click:function(){r(-1)},children:"\u2193"}),Object(we.jsx)(ye,{click:function(){r(1)},children:"\u2191"})]})}function Le(e){var t=e.children,n=e.setState,i=Object(u.e)(q);return Object(r.useEffect)((function(){function e(e){"escape"===e.key.toLowerCase()&&n(!1)}return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[]),Object(we.jsx)("div",{style:{position:"fixed",left:0,top:i,right:0,bottom:0,display:"flex",justifyContent:"center",alignItems:"start",paddingTop:16},onClick:function(e){n(!1)},children:Object(we.jsx)("div",{style:{background:"white",width:320,border:"solid 1px #000"},children:t})})}function Me(e){var t=e.name,n=e.children,r=e.style,i=e.state,c=e.setState;return Object(we.jsxs)("div",{children:[Object(we.jsx)("div",{className:i?"active":"hover",role:"button",onClick:function(e){c(!i)},style:Object(xe.a)({width:"8.5ch",cursor:"pointer",userSelect:"none"},r),children:t}),i?Object(we.jsx)(Le,{setState:c,children:n}):null]})}var Ee=function(){var e=Object(u.d)(_),t=Object(d.a)(e,2),n=t[0],r=t[1],i=Object(u.d)(Q),c=Object(d.a)(i,2),o=c[0],a=c[1],h=Object(u.d)(se),f=Object(d.a)(h,2),p=f[0],O=f[1],v=Object(u.d)(g),x=Object(d.a)(v,2),y=x[0],m=x[1],k=Object(u.f)(V),C=Object(u.e)(j),L=Object(u.f)(Z),M=Object(u.f)(J),E=Object(u.f)(ae),P=Object(u.e)(ce),R=Object(u.d)(Y),S=Object(d.a)(R,2),I=S[0],z=(S[1],Object(u.e)(K)),D=Object(u.d)(w),A=Object(d.a)(D,2),B=A[0],T=A[1],N=Object(u.f)(ie),H=Object(u.e)(q),F=Object(u.d)($),U=Object(d.a)(F,2),W=U[0],X=U[1],te=Object(u.d)(ee),ne=Object(d.a)(te,2),re=ne[0],oe=ne[1],le=Object(u.d)(G),ue=Object(d.a)(le,2),je=ue[0],fe=ue[1];function pe(){return(pe=Object(l.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,de(y.src);case 2:t=e.sent,m(t),b.image=t;case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oe(e,t){r(!1),X(!1),a(!1),O(!1),e(t)}return Object(we.jsxs)("div",{style:{borderBottom:"solid 1px #000",display:"flex",justifyContent:C[0]<640?"space-evenly":"center",lineHeight:H+"px",position:"relative",zIndex:9,textAlign:"center",userSelect:"none"},children:[Object(we.jsxs)(Me,{name:"Image",state:n,setState:Oe.bind(null,r),children:[Object(we.jsx)(me,{click:function(){he((function(e){m(e),b.image=e,k([])}))},children:"Open image"}),Object(we.jsx)(me,{click:function(){return pe.apply(this,arguments)},children:"Revert image"}),Object(we.jsx)(me,{click:be,children:"Save as image"}),Object(we.jsxs)(me,{click:function(){fe(!je)},children:[je?"Pause":"Unpause"," flows"]}),Object(we.jsx)(me,{click:function(){k([])},children:"Clear flows"})]}),Object(we.jsxs)(Me,{name:"Grid",state:W,setState:Oe.bind(null,X),children:[Object(we.jsxs)("div",{onClick:function(e){e.stopPropagation()},style:{display:"flex",justifyContent:"space-Between"},children:[Object(we.jsx)("div",{style:{lineHeight:"44px",height:44,padding:"0 8px"},children:"Cell size"}),Object(we.jsx)("div",{onClick:function(e){e.stopPropagation(),X(!1)},className:"hover",style:{lineHeight:"44px",height:44,width:44,cursor:"pointer"},children:"\xd7"})]}),Object(we.jsxs)(ke,{style:{padding:0,paddingLeft:"1ch",cursor:"default"},children:[Object(we.jsx)("div",{style:{width:"9ch",flexShrink:0,textAlign:"left",userSelect:"none"},children:"Width"})," ",Object(we.jsx)(Ce,{val:B[2],setVal:function(e){var t=B.slice();t[2]=e,T(t)},modifyVal:function(e){N([0,0,e,0])}})]}),Object(we.jsxs)(ke,{style:{padding:0,paddingLeft:"1ch",cursor:"default"},children:[Object(we.jsx)("div",{style:{width:"9ch",flexShrink:0,textAlign:"left",userSelect:"none"},children:"Height"}),Object(we.jsx)(Ce,{val:B[3],setVal:function(e){var t=B.slice();t[3]=e,T(t)},modifyVal:function(e){N([0,0,0,e])}})]}),Object(we.jsxs)(ke,{style:{padding:0,paddingLeft:"1ch",cursor:"default"},children:[Object(we.jsx)("div",{style:{width:"9ch",flexShrink:0,textAlign:"left",userSelect:"none"},children:"X offset"})," ",Object(we.jsx)(Ce,{val:B[0],setVal:function(e){var t=B.slice();t[0]=e,T(t)},modifyVal:function(e){N([e,0,0,0])}})]}),Object(we.jsxs)(ke,{style:{padding:0,paddingLeft:"1ch",userSelect:"none",cursor:"default"},children:[Object(we.jsx)("div",{style:{width:"9ch",flexShrink:0,textAlign:"left"},children:"Y offset"})," ",Object(we.jsx)(Ce,{val:B[1],setVal:function(e){var t=B.slice();t[1]=e,T(t)},modifyVal:function(e){N([0,e,0,0])}})]})]}),Object(we.jsxs)(Me,{name:"View",state:o,setState:Oe.bind(null,a),children:[Object(we.jsxs)(me,{click:M,children:[I?"Hide":"Show"," grid"]}),Object(we.jsxs)(me,{click:L,children:[z?"Hide":"Show"," flow outlines"]}),Object(we.jsxs)(me,{click:E,children:[P?"Hide":"Show"," keyboard controls"]}),Object(we.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",padding:"0 8px",height:44,borderBottom:"solid 1px #000",alignItems:"center",userSelect:"none"},children:[Object(we.jsx)("div",{children:"Cursor color"}),Object(we.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[Object(we.jsx)("input",{style:{display:"block"},type:"color",value:re,onClick:function(e){e.stopPropagation()},onChange:function(e){oe(e.target.value)}}),"\xa0",Object(we.jsx)("div",{children:"Reset"})]})]})]}),Object(we.jsxs)(Me,{name:"About",state:p,setState:Oe.bind(null,O),children:[Object(we.jsxs)("div",{onClick:function(e){e.stopPropagation()},style:{display:"flex",justifyContent:"space-Between"},children:[Object(we.jsx)("div",{style:{lineHeight:"44px",height:44,padding:"0 8px"},children:"About"}),Object(we.jsx)("div",{onClick:function(e){e.stopPropagation(),O(!1)},className:"hover",style:{lineHeight:"44px",height:44,width:44,cursor:"pointer"},children:"\xd7"})]}),Object(we.jsxs)("div",{style:{textAlign:"left",padding:"0 8px 8px",lineHeight:"18px"},children:[Object(we.jsx)("p",{children:"Flow is an experimental image editor. Set and direct pixel-flows using touch or keyboard controls. Overlap flows to create interesting effects."}),Object(we.jsxs)("p",{children:["A"," ",Object(we.jsx)("a",{href:"https://constraint.systems",target:"_blank",rel:"noreferrer",children:"Constraint Systems"})," ","project"]})]})]})]})};function Pe(e){var t=e.children,n=e.click,r=e.style;return Object(we.jsx)("div",{role:"button",className:"hover",onClick:n,style:Object(xe.a)({textAlign:"center"},r),children:t})}var Re=function(){var e=Object(u.d)(v),t=Object(d.a)(e,2),n=t[0],r=(t[1],Object(u.d)(G)),i=Object(d.a)(r,2),c=i[0],o=(i[1],Object(u.e)(g),Object(u.e)(ee),Object(u.f)(X)),a=(Object(u.e)(te),Object(u.e)(j)),s=Object(u.f)(ne),l=Object(u.f)(re),h=Object(u.e)(q);return Object(we.jsxs)("div",{style:{borderTop:"solid 1px #000",display:"flex",justifyContent:a[0]<640?"space-evenly":"center",lineHeight:h+6+"px",textAlign:"center"},children:[Object(we.jsx)(Pe,{click:be,style:{width:"8.5ch"},children:"Save"}),c?Object(we.jsx)(Pe,{click:o,style:{width:"8.5ch"},children:"Pause"}):Object(we.jsx)(Pe,{click:o,style:{width:"8.5ch",background:"#444",color:"#fff"},children:"Paused"}),Object(we.jsxs)("div",{style:{width:"8.5ch"},children:[Math.round(100*n),"%"]}),Object(we.jsx)(Pe,{style:{minWidth:"5.5ch"},click:function(){s()},children:"+"}),Object(we.jsx)(Pe,{style:{minWidth:"5.5ch"},click:function(){l()},children:"-"})]})};function Se(e){var t=e.children,n=e.style;return Object(we.jsx)("div",{style:Object(xe.a)({paddingTop:4,paddingBottom:4,paddingLeft:"1ch",paddingRight:"1ch",display:"flex"},n),children:t})}function Ie(e){var t=e.char,n=e.children,r=e.style;return Object(we.jsxs)(Se,{children:[Object(we.jsx)("div",{style:Object(xe.a)({outline:"solid 1px black",paddingLeft:"0.5ch",paddingRight:"0.5ch",marginRight:"1ch"},r),children:t})," ",Object(we.jsx)("div",{children:n})]})}var ze=function(){var e=Object(u.e)(j),t=Object(u.e)(U),n=Object(u.e)(q),r=Object(u.d)(ce),i=Object(d.a)(r,2),c=i[0],o=i[1],a="#e6e6e6";return Object(we.jsxs)("div",{style:{position:"fixed",right:0,top:n+1,height:e[1]-(2*n+6+2),borderLeft:"solid 1px #000",background:"white",width:320,overflow:"auto",display:c?"block":"none"},children:[Object(we.jsx)("div",{className:"hover",onClick:function(){return o(!1)},style:{width:"6ch",position:"absolute",cursor:"pointer",textAlign:"center",right:0,paddingTop:4,paddingBottom:4,lineHeight:n+"px"},children:"\xd7"}),Object(we.jsx)(Se,{style:{lineHeight:n+"px"},children:"Keyboard controls"}),Object(we.jsxs)("div",{style:{background:"move"===t?a:"none",paddingBottom:4},children:[Object(we.jsx)(Se,{children:"Move"}),Object(we.jsx)(Ie,{char:"\u2190\u2191\u2193\u2192",children:"Move cursor"}),Object(we.jsx)(Ie,{char:"+shift",children:"Move by cursor size"}),Object(we.jsx)(Ie,{char:"enter",children:"Flow mode"}),Object(we.jsx)(Ie,{char:"r",children:"Resize cursor mode"})]}),Object(we.jsxs)("div",{style:{background:"flow"===t?a:"none",paddingBottom:4},children:[Object(we.jsx)(Se,{children:"Flow"}),Object(we.jsx)(Ie,{char:"\u2190\u2191\u2193\u2192",children:"Choose flow direction"}),Object(we.jsx)(Ie,{char:"escape/x",children:"cancel"})]}),Object(we.jsxs)("div",{style:{background:"resize"===t?a:"none",paddingBottom:4},children:[Object(we.jsx)(Se,{children:"Resize cursor"}),Object(we.jsx)(Ie,{char:"\u2190\u2192",children:"Change width"}),Object(we.jsx)(Ie,{char:"\u2191\u2193",children:"Change height"}),Object(we.jsx)(Ie,{char:"enter/escape",children:"finish"})]}),Object(we.jsxs)("div",{style:{paddingBottom:4},children:[Object(we.jsx)(Se,{children:"Image"}),Object(we.jsx)(Ie,{char:"o",children:"Open image"}),Object(we.jsx)(Ie,{char:"i",children:"Revert image"}),Object(we.jsx)(Ie,{char:"p",children:"Save as image"}),Object(we.jsx)(Ie,{char:"space",children:"Toggle flows"}),Object(we.jsx)(Ie,{char:"c",children:"Clear flows"})]}),Object(we.jsxs)("div",{style:{paddingBottom:4},children:[Object(we.jsx)(Se,{children:"Grid"}),Object(we.jsx)(Ie,{char:"g",children:"Show grid controls"})]}),Object(we.jsxs)("div",{style:{paddingBottom:4},children:[Object(we.jsx)(Se,{children:"View"}),Object(we.jsx)(Ie,{char:"+/-",children:"Zoom in/out"}),Object(we.jsx)(Ie,{char:";",children:"Toggle grid"}),Object(we.jsx)(Ie,{char:"/",children:"Toggle flow outlines"}),Object(we.jsx)(Ie,{char:"?",children:"Toggle shortcuts"})]}),Object(we.jsxs)("div",{style:{paddingBottom:4},children:[Object(we.jsx)(Se,{children:"Vimkeys"}),Object(we.jsx)(Ie,{char:"hjkl",children:"Alternative to arrows"})]}),Object(we.jsxs)("div",{style:{paddingBottom:4},children:[Object(we.jsx)(Se,{children:"About"}),Object(we.jsx)(Ie,{char:"a",children:"Show about"})]})]})};var De=function(){var e=Object(u.d)(U),t=Object(d.a)(e,2),n=t[0],i=t[1],c=Object(u.e)(C),o=Object(u.e)(O),a=Object(u.e)(F),s=Object(u.f)(T),l=Object(u.f)(W),h=Object(u.e)(q),b=Object(u.e)(ee),j=Object(u.e)(p),f=Object(u.f)(I),g=Object(r.useRef)(!1),v=function(e){var t=j.getBoundingClientRect();return[e.clientX-t.left,e.clientY-t.top]},x=function(e){l(e),i("move")},w=Object(d.a)(c,4),y=w[0],m=w[1],k=w[2],L=w[3],M=h,E=h,P=o+2;function R(e,t){g.current=!0,f({pinCorner:e});var n=v(t);s({pixel:n}),i("resize"),t.target.setPointerCapture(t.pointerId)}function S(e){if(g.current){var t=v(e);s({pixel:t})}}function z(e){if(g.current){var t=v(e);s({pixel:t}),g.current=!1,i("flow"),e.target.releasePointerCapture(e.pointerId)}}var D=y+k/2,A=m+L/2,B=D,N=A,H=Math.max(k,3*h),V=Math.max(L,3*h),G=B-H/2,X=N-V/2;G<o+h/2&&(G=h/2+o,H>3*h&&(H-=h/2)),X<o+h/2&&(X=h/2+o,V>3*h&&(V-=h/2)),G+H>a[0]-2*o&&(H>3*h?H-=h/2:G-=h+2*o),X+V>a[1]-2*o&&(V>3*h?V-=h/2:X-=h+2*o);var Y=E-2;return"flow"===n||"resize"===n?Object(we.jsxs)("div",{style:{position:"absolute",left:0,top:0,width:a[0],height:a[1],overflow:"hidden"},children:[Object(we.jsxs)("div",{style:{position:"absolute",left:D-k/2,top:A-L/2,width:k,height:L,fontSize:M>40?20:15,lineHeight:h+"px",textAlign:"center",userSelect:"none"},children:[Object(we.jsx)("div",{className:"stopClick",onPointerDown:R.bind(null,"bottomRight"),onPointerMove:S,onPointerUp:z,style:{position:"absolute",left:-Y,top:-Y,width:E,height:E,cursor:"nwse-resize"},children:Object(we.jsx)("div",{style:{position:"absolute",right:0,bottom:0,width:P,height:P,pointerEvents:"none",background:b}})}),Object(we.jsx)("div",{className:"stopClick",onPointerDown:R.bind(null,"bottomLeft"),onPointerMove:S,onPointerUp:z,style:{position:"absolute",right:-Y,top:-Y,width:E,height:E,cursor:"nesw-resize"},children:Object(we.jsx)("div",{style:{position:"absolute",left:0,bottom:0,width:P,height:P,pointerEvents:"none",background:b}})}),Object(we.jsx)("div",{className:"stopClick",onPointerDown:R.bind(null,"topRight"),onPointerMove:S,onPointerUp:z,style:{position:"absolute",left:-Y,bottom:-Y,width:E,height:E,cursor:"nesw-resize"},children:Object(we.jsx)("div",{style:{position:"absolute",right:0,top:0,width:P,height:P,pointerEvents:"none",background:b}})}),Object(we.jsx)("div",{className:"stopClick hover",onPointerDown:R.bind(null,"topLeft"),onPointerMove:S,onPointerUp:z,style:{position:"absolute",right:-Y,bottom:-Y,width:E,height:E,cursor:"nwse-resize"},children:Object(we.jsx)("div",{style:{position:"absolute",left:0,top:0,width:P,height:P,pointerEvents:"none",background:b}})})]}),"flow"===n?Object(we.jsxs)("div",{style:{position:"absolute",left:G,top:X,width:H,height:V,fontSize:M>40?20:15,lineHeight:h+"px",textAlign:"center",userSelect:"none"},children:[Object(we.jsx)("div",{className:"stopClick hover",onPointerDown:function(){return i("resize")},style:{position:"absolute",top:"calc(50% - ".concat(h/2,"px)"),left:"calc(50% - ".concat(h/2,"px)"),width:h,height:h,background:b,cursor:"pointer"},children:"\xd7"}),Object(we.jsx)("div",{className:"stopClick hoverParent",onPointerDown:function(){return x("n")},style:{position:"absolute",top:-h/2,left:"calc(50% - ".concat(h/2,"px)"),width:h,height:1.25*h,cursor:"pointer"},children:Object(we.jsx)("div",{className:"hoverChild",style:{position:"absolute",left:0,top:0,width:h,height:h,background:b,cursor:"pointer",pointerEvents:"none"},children:"\u2191"})}),Object(we.jsx)("div",{className:"stopClick hoverParent",onPointerDown:function(){return x("s")},style:{position:"absolute",bottom:-h/2,left:"calc(50% - ".concat(h/2,"px)"),width:h,height:1.25*h,cursor:"pointer"},children:Object(we.jsx)("div",{className:"hoverChild",style:{position:"absolute",left:0,bottom:0,width:h,height:h,background:b,cursor:"pointer",pointerEvents:"none"},children:"\u2193"})}),Object(we.jsx)("div",{className:"stopClick hoverParent",onPointerDown:function(){return x("w")},style:{position:"absolute",left:-h/2,top:"calc(50% - ".concat(h/2,"px)"),width:1.25*h,height:h,cursor:"pointer"},children:Object(we.jsx)("div",{className:"hoverChild",style:{position:"absolute",left:0,top:0,width:h,height:h,background:b,cursor:"pointer",pointerEvents:"none"},children:"\u2190"})}),Object(we.jsx)("div",{className:"stopClick hoverParent",onPointerDown:function(){return x("e")},style:{position:"absolute",right:-h/2,top:"calc(50% - ".concat(h/2,"px)"),width:1.25*h,height:h,cursor:"pointer"},children:Object(we.jsx)("div",{className:"hoverChild",style:{position:"absolute",right:0,top:0,width:h,height:h,background:b,cursor:"pointer",pointerEvents:"none"},children:"\u2192"})})]}):null]}):null};var Ae=function(){var e=Object(u.e)(j),t=Object(u.e)(F),n=Object(u.e)(q),i=Object(r.useRef)(null),c=Object(r.useRef)([0,0]),o=Object(r.useRef)(!1),a=Object(u.e)(oe),s=n+2,l=e[1]-2*s;Object(r.useEffect)((function(){var e=i.current,t=function(t){t.stopPropagation(),c.current=[t.clientX,t.clientY],o.current=!0,e.setPointerCapture(t.pointerId)},n=function(t){if(t.stopPropagation(),o.current){var n=[t.clientX,t.clientY];!function(t){var n;(n=e.parentElement.parentElement).scrollBy.apply(n,Object(h.a)(t))}([4*(n[0]-c.current[0]),4*(n[1]-c.current[1])]),c.current=n}},r=function(t){t.stopPropagation(),o.current=!1,e.releasePointerCapture(t.pointerId)};return e.addEventListener("pointerdown",t),e.addEventListener("pointermove",n),e.addEventListener("pointerup",r),function(){e.removeEventListener("pointerdown",t),e.removeEventListener("pointermove",n),e.removeEventListener("pointerup",r)}}),[]);var d=t[1]>l||t[0]>e[0]-a;return Object(we.jsx)("div",{ref:i,style:{position:"fixed",left:"calc(50% - ".concat(a/2,"px)"),top:"50%",marginTop:-24,marginLeft:-24,width:48,height:48,border:"solid 8px rgba(255,255,255,0.5)",background:"rgba(0,0,0,0.6)",zIndex:999,borderRadius:"100%",touchAction:"none",display:d?"block":"none",cursor:"grab",userSelect:"none"}})};function Be(){var e=Object(u.e)(j),t=Object(u.f)(f),n=Object(u.f)(ce);return Object(r.useEffect)((function(){return t(),window.innerWidth>1200&&n(!0),window.addEventListener("resize",t),function(){window.removeEventListener("resize",t)}}),[]),Object(we.jsxs)("div",{style:{width:"100%",height:"100vh",touchAction:"none"},children:[Object(we.jsx)("input",{type:"file",id:"fileInput",style:{display:"none"}}),null!==e[0]?Object(we.jsx)(Te,{}):null]})}function Te(){return Object(we.jsxs)("div",{id:"scrollContainer",children:[Object(we.jsx)(Ee,{}),Object(we.jsx)(Ne,{}),Object(we.jsx)(Re,{}),Object(we.jsx)(ze,{})]})}function Ne(){var e=Object(r.useRef)(null),t=Object(u.e)(oe),n=Object(u.d)(p),i=Object(d.a)(n,2),c=i[0],o=i[1];return Object(r.useEffect)((function(){o(e.current)}),[]),Object(we.jsxs)("div",{style:{position:"relative",flexGrow:1,overflow:"auto",display:"flex",paddingRight:t,cursor:"crosshair",touchAction:"none"},children:[Object(we.jsxs)("div",{style:{position:"relative",margin:"auto"},children:[Object(we.jsx)("canvas",{id:"render",ref:e,children:null!==c?Object(we.jsx)(Fe,{}):null}),Object(we.jsx)(Ae,{}),Object(we.jsx)(De,{})]}),Object(we.jsx)(He,{})]})}function He(){var e=Object(u.e)(w),t=Object(u.e)(H),n=Object(u.e)(O),i=Object(u.e)(v),c=Object(u.e)(j),o=Object(u.e)(g),a=Object(u.e)(C);return Object(r.useEffect)((function(){b.visibleCursor=a,b.zoom=i,b.padding=n,b.windowSize=c,b.image=o}),[n,t,e,a,i,c,o]),null}function Fe(){return Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(Ve,{}),Object(we.jsx)(ge,{}),Object(we.jsx)(ve,{})]})}var Ue=function(e){var t=e.canvas,n=e.layers,r=t,i=t.getContext("2d");i.clearRect(0,0,r.width,r.height),i.drawImage(n.imageLayer,0,0,b.image.width,b.image.height,b.padding,b.padding,r.width-2*b.padding,r.height-2*b.padding),i.drawImage(n.flowsLayer,0,0,r.width,r.height,0,0,r.width,r.height),i.globalAlpha=.3,i.drawImage(n.gridLayer,0,0,r.width,r.height,0,0,r.width,r.height),i.globalAlpha=1,i.drawImage(n.cursorLayer,0,0,r.width,r.height,0,0,r.width,r.height)};function Ve(){var e=Object(u.e)(p),t=Object(u.d)(g),n=Object(d.a)(t,2),i=n[0],c=n[1],o=Object(u.e)(F),a=Object(u.e)(q),h=Object(u.f)(v),j=Object(r.useRef)({imageLayer:new OffscreenCanvas(10,10),flowsLayer:new OffscreenCanvas(10,10),gridLayer:new OffscreenCanvas(10,10),cursorLayer:new OffscreenCanvas(10,10),scratchLayer:new OffscreenCanvas(10,10)}),f=Object(r.useRef)(null),O=Object(u.e)(G);return Object(r.useEffect)((function(){function e(){return(e=Object(l.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,de("/images/iron.jpg");case 2:t=e.sent,c(t),b.image=t;case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}(),b.layersRef=j}),[]),Object(r.useEffect)((function(){""!==i.src&&(O?(null!==f.current&&clearInterval(f.current),f.current=setInterval((function(){for(var t=j.current.imageLayer,n=t.getContext("2d"),r=j.current.scratchLayer,i=r.getContext("2d"),c=0;c<b.flows.length;c++){var o=b.flows[c],a=o.dir,s=Object(d.a)(o.cursor,4),l=s[0],u=s[1],h=s[2],f=s[3];r.width=h,r.height=f,"e"===a?(i.drawImage(t,l,u,h-1,f,1,0,h-1,f),i.drawImage(t,l+h-1,u,1,f,0,0,1,f)):"w"===a?(i.drawImage(t,l+1,u,h-1,f,0,0,h-1,f),i.drawImage(t,l,u,1,f,h-1,0,1,f)):"s"===a?(i.drawImage(t,l,u,h,f-1,0,1,h,f-1),i.drawImage(t,l,u+f-1,h,1,0,0,h,1)):"n"===a&&(i.drawImage(t,l,u+1,h,f-1,0,0,h,f-1),i.drawImage(t,l,u,h,1,0,f-1,h,1)),n.drawImage(r,0,0,h,f,l,u,h,f)}Ue({canvas:e,layers:j.current})}),20)):clearInterval(f.current))}),[O,i]),Object(r.useEffect)((function(){if(""!==i.src){var e=Object(d.a)(b.windowSize,2),t=e[0],n=e[1];n-=2*a+2+6;var r=null;(i.width+2*b.padding)/(i.height+2*b.padding)>t/n?(r=(t-2*b.padding)/i.width,h(r)):r=(n-2*b.padding)/i.height,h(r)}}),[i,a]),Object(r.useEffect)((function(){e.width=o[0],e.height=o[1],Ue({canvas:e,layers:j.current})}),[o]),Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(We,{layersRef:j}),Object(we.jsx)(Xe,{layersRef:j}),Object(we.jsx)(Ye,{layersRef:j}),Object(we.jsx)(Ge,{layersRef:j})]})}function We(e){var t=e.layersRef,n=Object(u.e)(p),i=Object(u.e)(g),c=t.current;return Object(r.useEffect)((function(){if(i){var e=c.imageLayer;e.width=i.width,e.height=i.height;var t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),t.drawImage(i,0,0,i.width,i.height,0,0,i.width,i.height),Ue({canvas:n,layers:c})}}),[i]),null}function Ge(e){var t=e.layersRef,n=Object(u.e)(p),i=Object(u.e)(g),c=t.current,o=Object(u.e)(O),a=Object(u.e)(F),s=Object(u.e)(v),l=Object(u.e)(V),h=Object(u.e)(K);return Object(r.useEffect)((function(){if(i){var e=c.flowsLayer;e.width=a[0],e.height=a[1];var t=e.getContext("2d");if(t.clearRect(0,0,e.width,e.height),h){t.strokeStyle="white",t.lineWidth=2;for(var r=0;r<l.length;r++){var u=l[r],b=Object(d.a)(u.cursor,4),j=b[0],f=b[1],p=b[2],O=b[3];t.strokeRect(j*s+o,f*s+o,p*s,O*s)}}Ue({canvas:n,layers:c})}}),[a,i,s,l,h]),Object(r.useEffect)((function(){b.flows=l}),[l]),null}function Xe(e){var t=e.layersRef,n=Object(u.e)(p),i=(Object(u.e)(g),t.current),c=Object(u.e)(O),o=Object(u.e)(F),a=Object(u.e)(v),s=Object(u.e)(w),l=Object(u.e)(H),d=Object(u.e)(N),h=Object(u.e)(Y),b=Object(u.e)($);return Object(r.useEffect)((function(){var e=function(e){return e+c},t=i.gridLayer;t.width=o[0],t.height=o[1];var r=t.getContext("2d");if(r.clearRect(0,0,t.width,t.height),h||b){r.strokeStyle="#ccc",r.lineWidth=2;for(var u=0;u<l.cols;u++){var j=u*s[2]+l.xoff;r.beginPath(),r.moveTo(e(j*a),e(d.y1*a)),r.lineTo(e(j*a),e(d.y2*a)),r.stroke()}for(var f=0;f<l.rows;f++){var p=f*s[3]+l.yoff;r.beginPath(),r.moveTo(e(d.x1*a),e(p*a)),r.lineTo(e(d.x2*a),e(p*a)),r.stroke()}}Ue({canvas:n,layers:i})}),[s,o,a,h,b]),null}function Ye(e){var t=e.layersRef,n=Object(u.e)(p),i=t.current,c=(Object(u.e)(O),Object(u.e)(F)),o=Object(u.e)(v),a=Object(u.e)(w),s=(Object(u.e)(H),Object(u.e)(y)),l=Object(u.e)(C),h=Object(u.e)(L),b=Object(u.e)(U),j=Object(u.e)(ee);return Object(r.useEffect)((function(){var e=i.cursorLayer;e.width=c[0],e.height=c[1];var t=e.getContext("2d");t.clearRect(0,0,e.width,e.height);var r=Object(d.a)(l,4),o=r[0],a=r[1],s=r[2],u=r[3];t.strokeStyle=j,t.lineWidth=2,t.strokeRect(o,a,s,u);var b=Object(d.a)(h,4),f=b[0],p=b[1],O=b[2],g=b[3];t.lineWidth=4,f&&(t.beginPath(),t.moveTo(o,a),t.lineTo(o,a+u),t.stroke()),p&&(t.beginPath(),t.moveTo(o,a),t.lineTo(o+s,a),t.stroke()),O&&(t.beginPath(),t.moveTo(o+s,a),t.lineTo(o+s,a+u),t.stroke()),g&&(t.beginPath(),t.moveTo(o,a+u),t.lineTo(o+s,a+u),t.stroke()),Ue({canvas:n,layers:i})}),[a,s,c,o,b,j]),null}var Je=function(){return Object(we.jsx)(u.a,{children:Object(we.jsx)(Be,{})})},Ke=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,26)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),r(e),i(e),c(e),o(e)}))};o.a.render(Object(we.jsx)(i.a.StrictMode,{children:Object(we.jsx)(Je,{})}),document.getElementById("root")),Ke()}},[[25,1,2]]]);
//# sourceMappingURL=main.72541fb1.chunk.js.map